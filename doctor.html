<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sehat Sahara - Doctor Dashboard</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg-color: rgba(245, 245, 245, 0.6);
            --card-bg-color: rgba(255, 255, 255, 0.7);
            --text-color: #0f172a;
            --text-color-secondary: #475569;
            --primary-color: #0d9488;
            --primary-color-light: #2dd4bf;
            --primary-color-dark: #14b8a6;
            --sos-color: #ef4444;
            --border-color: rgba(0, 0, 0, 0.07);
            --shadow-color: rgba(100, 116, 139, 0.1);
            --font-family: 'Poppins', sans-serif;
            --color-secondary: #f1f5f9;
            --radius-lg: 16px;
            --color-video: #3b82f6;
            --color-audio: #16a34a;
            --color-photo: #f97316;
            --color-pending: #f59e0b;
            --color-paid: #22c55e;
        }

        [data-theme="dark"] {
            --bg-color: rgba(20, 20, 30, 0.75);
            --card-bg-color: rgba(30, 41, 59, 0.6);
            --text-color: #e2e8f0;
            --text-color-secondary: #94a3b8;
            --border-color: rgba(255, 255, 255, 0.12);
            --primary-color: var(--primary-color-dark);
            --color-secondary: #334155;
            --shadow-color: rgba(0, 0, 0, 0.2);
        }

        html { scroll-behavior: smooth; }
        * { box-sizing: border-box; margin: 0; padding: 0; }
        body { 
            font-family: var(--font-family); 
            background-color: var(--bg-color); 
            color: var(--text-color); 
            line-height: 1.6; 
            padding-bottom: 80px; /* Space for bottom nav */
            transition: background-color 0.3s, color 0.3s;
        }
        .main-container { position: relative; min-height: 100vh; width: 100vw; }
        .background-image { 
            position: fixed; top: 0; left: 0; width: 100%; height: 100%; 
            background-image: url('https://i.ibb.co/84XpXLXW/hero-pic.png'); 
            background-size: cover; background-position: center; 
            filter: blur(14px) brightness(0.9); 
            transform: scale(1.15); z-index: -1; 
            transition: filter 0.3s;
        }
        [data-theme="dark"] .background-image { filter: blur(14px) brightness(0.6); }

        .page-content { flex-grow: 1; padding: 1rem; max-width: 1200px; margin: 0 auto; width: 100%; padding-top: 80px; }
        
        /* Header */
        .header {
            position: fixed; top: 1rem; left: 50%; transform: translateX(-50%);
            width: calc(100% - 2rem); max-width: 1200px;
            display: flex; justify-content: space-between; align-items: center;
            padding: 0.75rem 1.25rem; z-index: 1000;
            background-color: var(--card-bg-color); border: 1px solid var(--border-color);
            border-radius: 999px;
            backdrop-filter: blur(24px); -webkit-backdrop-filter: blur(24px);
            box-shadow: 0 8px 32px 0 var(--shadow-color);
        }
        .header .logo { font-size: 1.5rem; font-weight: 700; color: var(--primary-color); }
        .header .actions { display: flex; align-items: center; gap: 0.75rem; }
        
        .top-nav { display: none; align-items: center; gap: 0.25rem; }
        .top-nav a { text-decoration: none; color: var(--text-color-secondary); font-weight: 500; padding: 0.5rem 1.25rem; border-radius: 999px; transition: all 0.25s ease; position: relative; }
        .top-nav a:hover { color: var(--text-color); background-color: rgba(128, 128, 128, 0.1); }
        .top-nav a.active { color: var(--text-color); background-color: rgba(128, 128, 128, 0.15); }

        .btn { padding: 0.6rem 1.2rem; border-radius: 9999px; border: none; cursor: pointer; font-weight: 600; font-size: 14px; transition: all 0.25s ease; }
        .btn:hover { transform: translateY(-3px); box-shadow: 0 6px 15px rgba(0,0,0,0.12); }
        .btn-sos { background-color: var(--sos-color); color: white; }
        .btn-primary { background-color: var(--primary-color); color: white; border: 2px solid var(--primary-color); }
        .btn-sm { padding: 0.4rem 0.8rem; font-size: 12px; }
        .btn-call { background-color: var(--color-audio); color: white; }
        .btn-message { background-color: var(--color-video); color: white; }
        .btn-neutral { background-color: white; color: var(--text-color-secondary); border: 1px solid var(--border-color); }
        .btn-neutral:hover { background-color: #f8fafc; }

        [data-theme="dark"] .btn-neutral {
            background-color: var(--color-secondary);
            color: var(--text-color);
        }
        [data-theme="dark"] .btn-neutral:hover {
            background-color: #475569;
        }


        .card { 
            background-color: var(--card-bg-color); border-radius: var(--radius-lg); 
            padding: 1.5rem; border: 1px solid var(--border-color); 
            backdrop-filter: blur(24px); -webkit-backdrop-filter: blur(24px); 
            box-shadow: 0 8px 32px 0 var(--shadow-color); transition: all 0.3s ease;
        }
        .card:hover { transform: translateY(-5px); box-shadow: 0 12px 40px 0 var(--shadow-color); }

        .screen { display: none; }
        .screen.active { display: block; animation: fadeIn 0.5s ease; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        
        /* Dashboard Screen */
        .welcome-card { 
            background: linear-gradient(45deg, var(--primary-color), var(--primary-color-light)); 
            color: white; 
            margin-bottom: 1.5rem;
            margin-top: 2rem;
        }
        .welcome-card h1 { font-size: 2.25rem; }
        .info-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 1.5rem; margin-bottom: 1.5rem; }
        .info-card { cursor: pointer; transition: all 0.2s ease-in-out; }
        .info-card:hover { transform: scale(1.03); box-shadow: 0 10px 30px 0 var(--shadow-color); }
        .info-card h3 { font-size: 1rem; }
        .info-card .highlight { font-size: 1.25rem; font-weight: 600; }
        
        /* Appointments & History*/
        .appointments-list { display: flex; flex-direction: column; gap: 1rem; }
        .appointment-card, .history-card { display: flex; justify-content: space-between; align-items: center; padding: 1rem 1.5rem; }
        .appointment-card-details h4 { font-size: 1.1rem; }
        .appointment-card-details p { font-size: 0.9rem; color: var(--text-color-secondary); }
        .appointment-type-indicator { width: 10px; height: 40px; border-radius: 5px; margin-right: 1rem; }
        .type-video { background-color: var(--color-video); }
        .type-audio { background-color: var(--color-audio); }
        .type-photo { background-color: var(--color-photo); }
        .appointment-actions { display: flex; gap: 0.5rem; flex-wrap: wrap; justify-content: flex-end; }
        
        /* Page Headers */
        .page-header { text-align: center; margin-bottom: 2rem; margin-top: 2rem; }
        .page-header h1 { font-size: 2rem; }

        /* History */
        .status-badge { padding: 0.25rem 0.75rem; border-radius: 999px; font-size: 0.8rem; font-weight: 600; color: white; text-transform: capitalize; }
        .status-done { background-color: var(--color-paid); }
        .status-missed { background-color: var(--sos-color); }
        .status-rescheduled { background-color: var(--color-pending); }


        /* Consultation Screen */
        .consultation-view { 
            text-align: center; 
            background: linear-gradient(145deg, rgba(173, 216, 230, 0.5), rgba(240, 248, 255, 0.5));
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            padding: 2rem;
        }
        .consultation-view h1 { font-size: 1.75rem; margin-bottom: 1.5rem; color: var(--text-color); }
        .video-placeholder { width: 100%; max-width: 600px; height: 400px; background: #000; color: white; display: flex; align-items: center; justify-content: center; border-radius: var(--radius-lg); margin: 1rem auto; box-shadow: 0 10px 25px rgba(0,0,0,0.2); }
        
        /* Prescription Form */
        .form-group { margin-bottom: 1rem; text-align: left; }
        .form-group label { display: block; margin-bottom: 0.5rem; font-weight: 500; }
        .form-control { width: 100%; padding: 0.85rem; border-radius: 8px; border: 1px solid var(--border-color); background-color: var(--color-secondary); color: var(--text-color); }
        .upload-area { border: 2px dashed var(--border-color); border-radius: var(--radius-lg); padding: 2rem; text-align: center; cursor: pointer; }
        .upload-area:hover { border-color: var(--primary-color); }
        
        /* Bottom Navigation */
        .bottom-nav { position: fixed; bottom: 0; left: 0; right: 0; display: flex; justify-content: space-around; background-color: var(--card-bg-color); backdrop-filter: blur(24px); -webkit-backdrop-filter: blur(24px); box-shadow: 0 -4px 20px var(--shadow-color); border-top: 1px solid var(--border-color); padding: 0.5rem 0; z-index: 1000; }
        .nav-button { background: none; border: none; cursor: pointer; flex: 1; display: flex; flex-direction: column; align-items: center; gap: 4px; color: var(--text-color-secondary); padding: 0.5rem 0; transition: color 0.2s ease; }
        .nav-button.active { color: var(--primary-color); font-weight: 600; }
        .nav-button svg { width: 24px; height: 24px; }
        .nav-button span { font-size: 12px; }
        
        /* Language & Theme */
        .language-dropdown { position: relative; }
        .language-dropdown-toggle { cursor: pointer; background: transparent; border: none; color: var(--text-color-secondary); font-size: 1rem; padding: 8px; display: flex; align-items: center; border-radius: 999px; }
        .language-dropdown-menu { display: none; position: absolute; top: calc(100% + 8px); right: 0; min-width: 150px; border-radius: var(--radius-lg); padding: 8px; background: var(--card-bg-color); border: 1px solid var(--border-color); z-index: 1001; }
        .language-dropdown.open .language-dropdown-menu { display: block; }
        .language-option { display: block; padding: 8px 12px; color: var(--text-color-secondary); border-radius: 8px; cursor: pointer; }
        .theme-toggle { cursor: pointer; background-color: transparent; border: none; padding: 8px; display: flex; align-items: center; justify-content: center; color: var(--text-color-secondary); }

        /* Modals */
        .modal { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.6); display: none; align-items: center; justify-content: center; z-index: 2000; backdrop-filter: blur(5px); }
        .modal.active { display: flex; }
        .modal-content { background: var(--card-bg-color); border-radius: var(--radius-lg); padding: 2rem; max-width: 500px; width: calc(100% - 2rem); text-align: left; }
        .modal-content h3 { margin-bottom: 1rem; text-align: center; }
        .modal-actions { display: flex; gap: 1rem; justify-content: flex-end; margin-top: 1.5rem; }
        
        /* AI Summary & Rx Modals */
        .summary-section { margin-bottom: 1rem; }
        .summary-section h4 { font-weight: 600; color: var(--primary-color); border-bottom: 1px solid var(--border-color); padding-bottom: 0.5rem; margin-bottom: 0.5rem;}
        .summary-section ul, .summary-section p { list-style: none; padding-left: 0.5rem; }
        .summary-section li { margin-bottom: 0.25rem; }
        [data-theme="dark"] #prescriptionViewModal .modal-content { color: var(--text-color); }

        /* Message Modal */
        .chat-box { background-color: var(--color-secondary); border-radius: 8px; padding: 1rem; height: 40vh; overflow-y: auto; display: flex; flex-direction: column; gap: 0.75rem; }
        .chat-message { padding: 0.75rem 1rem; border-radius: 12px; max-width: 80%; box-shadow: 0 2px 4px rgba(0,0,0,0.05); border: 1px solid var(--border-color); line-height: 1.4; }
        .patient-message { background: white; border-radius: 12px 12px 12px 0; align-self: flex-start; }
        .doctor-message { background: var(--primary-color-light); color: white; border-radius: 12px 12px 0 12px; align-self: flex-end; }
        [data-theme="dark"] .patient-message { background: #475569; }
        .message-time { display: block; text-align: right; font-size: 0.75rem; margin-top: 0.25rem; }
        .patient-message .message-time { color: var(--text-color-secondary); }
        .doctor-message .message-time { color: rgba(255,255,255,0.7); }
        .chat-input-area { display: flex; gap: 0.5rem; margin-top: 1rem; align-items: center; }
        
        /* Responsive */
        @media (min-width: 768px) { .bottom-nav { display: none; } .top-nav { display: flex; } .header .actions { gap: 1rem; } .header { border-radius: 999px; } }
        @media (max-width: 767px) { 
            .header { position: static; transform: none; width: 100%; border-radius: 0; padding: 1rem; } 
            .page-content { padding-top: 1rem; } 
            .info-grid { grid-template-columns: 1fr; } 
            .appointment-card, .history-card { flex-direction: column; align-items: flex-start; gap: 1rem; } 
            .appointment-actions { width: 100%; justify-content: center; }
            .status-badge { width: 100%; text-align: center; }
        }
    </style>
</head>
<body data-theme="light">
    <div class="main-container">
        <div class="background-image"></div>
        <header class="header">
            <div class="logo">Sehat Sahara</div>
            <nav class="top-nav">
                <a href="#" class="active" data-key="dashboard_nav" data-screen="dashboardScreen">Dashboard</a>
                <a href="#" data-key="appointments_nav" data-screen="appointmentsScreen">Appointments</a>
                <a href="#" data-key="upload_nav" data-screen="uploadRxScreen">Upload Rx</a>
                <a href="#" data-key="earnings_nav" data-screen="earningsScreen">Earnings</a>
            </nav>
            <div class="actions">
                <div class="language-dropdown">
                    <button class="language-dropdown-toggle"><span id="selectedLanguage">English</span></button>
                    <div class="language-dropdown-menu"></div>
                </div>
                <button class="theme-toggle" id="themeToggle">
                    <svg id="themeIcon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path></svg>
                </button>
                 <button class="btn" id="logoutBtn" style="background-color: var(--text-color-secondary); color: white;" data-key="logout">Logout</button>
            </div>
        </header>
        <div class="page-content">
            <main class="main">
                <section id="dashboardScreen" class="screen active">
                     <div class="welcome-card card">
                        <h1 id="welcomeMessage" data-key="welcome_message">Welcome, Dr. Verma</h1>
                        <p data-key="welcome_subtitle">Your dashboard is ready.</p>
                    </div>
                    <div class="info-grid">
                        <div class="info-card card" data-screen="appointmentsScreen"><h3 data-key="upcoming_appointments">Upcoming Appointments</h3><p class="highlight">3</p><p data-key="for_today">For today</p></div>
                        <div class="info-card card" data-screen="historyScreen"><h3 data-key="recent_activity">Recent Activity</h3><p class="highlight">7</p><p data-key="last_4_days">Last 4 days</p></div>
                    </div>
                </section>
                
                <section id="appointmentsScreen" class="screen">
                    <div class="page-header"><h1 data-key="appointments_title">Today's Appointments</h1></div>
                    <div class="appointments-list" id="appointmentsList"></div>
                </section>
                
                <section id="historyScreen" class="screen">
                    <div class="page-header"><h1 data-key="history_title">Recent Activity</h1></div>
                    <div id="historyList" class="appointments-list"></div>
                </section>

                <section id="uploadRxScreen" class="screen">
                    <div class="page-header"><h1 data-key="upload_rx_title">Upload Offline Prescription</h1></div>
                     <form class="card" id="uploadRxForm">
                        <div class="form-group">
                            <label for="patient-select" data-key="select_patient">Select Patient</label>
                            <select id="patient-select" class="form-control"><option>Ramesh Kumar</option><option>Sunita Devi</option></select>
                        </div>
                        <div class="form-group">
                             <label data-key="upload_image">Upload Prescription Image</label>
                            <div class="upload-area">
                                <p data-key="drag_drop">Click to upload a photo</p>
                            </div>
                        </div>
                        <button type="submit" class="btn btn-primary" style="width:100%" data-key="save_to_record">Save to Patient Record</button>
                    </form>
                </section>

                <section id="earningsScreen" class="screen">
                    <div class="page-header"><h1 data-key="earnings_title">Earnings & History</h1></div>
                    <div class="card">
                        <div id="earningsList"></div>
                    </div>
                </section>

                <section id="consultationScreen" class="screen">
                    <div class="consultation-view card">
                        <h1 id="consultationHeader"></h1>
                        <div class="video-placeholder">Simulated Video Call...</div>
                        <div class="modal-actions" style="justify-content: center;">
                             <button class="btn btn-neutral" data-screen="prescriptionWriterScreen" data-key="write_prescription">Write Prescription</button>
                            <button class="btn btn-sos" data-screen="dashboardScreen" data-key="end_call">End Call</button>
                        </div>
                    </div>
                </section>

                <section id="prescriptionWriterScreen" class="screen">
                    <div class="page-header"><h1 data-key="prescription_writer_title">New Digital Prescription</h1></div>
                     <form class="card" id="prescriptionForm">
                        <p style="margin-bottom: 1rem;"><strong>Patient:</strong> <span id="prescriptionPatientName"></span></p>
                        <div class="form-group">
                            <label for="medicine-name" data-key="medicine_name">Medicine Name</label>
                            <input type="text" id="medicine-name" class="form-control" placeholder="e.g., Paracetamol 500mg">
                        </div>
                         <div class="form-group">
                            <label for="medicine-dosage" data-key="dosage">Dosage</label>
                            <input type="text" id="medicine-dosage" class="form-control" placeholder="e.g., 1-0-1 Before Food">
                        </div>
                        <div class="form-group">
                            <label for="medicine-advice" data-key="advice">Advice</label>
                            <textarea id="medicine-advice" class="form-control" rows="3"></textarea>
                        </div>
                        <button type="submit" class="btn btn-primary" style="width:100%" data-key="send_prescription">Sign & Send Prescription</button>
                    </form>
                </section>
            </main>
        </div>
    </div>
    
    <nav class="bottom-nav">
        <button class="nav-button active" data-screen="dashboardScreen"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="3" y="3" width="7" height="7"></rect><rect x="14" y="3" width="7" height="7"></rect><rect x="14" y="14" width="7" height="7"></rect><rect x="3" y="14" width="7" height="7"></rect></svg><span data-key="dashboard_nav">Dashboard</span></button>
        <button class="nav-button" data-screen="appointmentsScreen"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect><line x1="16" y1="2" x2="16" y2="6"></line><line x1="8" y1="2" x2="8" y2="6"></line><line x1="3" y1="10" x2="21" y2="10"></line></svg><span data-key="appointments_nav">Appointments</span></button>
        <button class="nav-button" data-screen="uploadRxScreen"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21.2 15c.7-1.2 1-2.5.7-3.9-.6-2.8-3.3-4.9-6.3-4.9h-1.2c-.3-1.4-1-2.7-2.1-3.6-1.5-1.2-3.5-1.4-5.2-.6S3 4.9 3 6.8v.2c0 2.4 1.7 4.5 4 5.1"/><path d="M8 12h8"/><path d="M12 16v-8"/></svg><span data-key="upload_nav">Upload Rx</span></button>
        <button class="nav-button" data-screen="earningsScreen"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="12" y1="1" x2="12" y2="23"></line><path d="M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"></path></svg><span data-key="earnings_nav">Earnings</span></button>
    </nav>
    
    <!-- Modals -->
    <div id="aiSummaryModal" class="modal">
        <div class="modal-content">
            <h3 id="summaryModalTitle"></h3>
            <div class="summary-section">
                <h4 data-key="summary_symptoms">Logged Symptoms</h4>
                <ul id="summarySymptoms"></ul>
            </div>
             <div class="summary-section">
                <h4 data-key="summary_vitals">Recent Vitals (from ASHA)</h4>
                <ul id="summaryVitals"></ul>
            </div>
             <div class="summary-section">
                <h4 data-key="summary_prescriptions">Active Prescriptions</h4>
                <ul id="summaryPrescriptions"></ul>
            </div>
            <div class="modal-actions">
                <button class="btn" id="closeSummaryModal" style="background: var(--color-secondary); color: var(--text-color);">Close</button>
                <button class="btn btn-primary" id="startCallFromSummary">Start Call</button>
            </div>
        </div>
    </div>
    
    <div id="messageModal" class="modal">
        <div class="modal-content">
            <h3 id="messageModalTitle">Message Patient</h3>
            <div id="chatBox" class="chat-box">
                <!-- Messages will be dynamically injected here -->
            </div>
            <div class="chat-input-area">
                <textarea id="doctor-reply" class="form-control" rows="2" placeholder="Type your reply..."></textarea>
                <button id="sendMessageBtn" class="btn btn-primary" style="border-radius: 8px; padding: 0.85rem;">Send</button>
            </div>
            <button class="btn" id="closeMessageModal" style="background: var(--color-secondary); color: var(--text-color); width: 100%; margin-top: 1rem;">Close Conversation</button>
        </div>
    </div>

    <div id="prescriptionViewModal" class="modal">
        <div class="modal-content">
            <h3>Last Digital Prescription for <span id="rxPatientName"></span></h3>
            <div class="summary-section">
                <h4 data-key="medicine_name">Medicine Name</h4>
                <p id="rxMedicine"></p>
            </div>
            <div class="summary-section">
                <h4 data-key="dosage">Dosage</h4>
                <p id="rxDosage"></p>
            </div>
            <div class="summary-section">
                <h4 data-key="advice">Advice</h4>
                <p id="rxAdvice"></p>
            </div>
            <div class="modal-actions" style="justify-content: center;">
                <button class="btn btn-primary" id="closeRxModal">Close</button>
            </div>
        </div>
    </div>

    <div id="confirmationModal" class="modal"><div class="modal-content" style="text-align:center;"><h3 id="modalTitle"></h3><p id="modalMessage"></p><button class="btn btn-primary" id="closeModal">OK</button></div></div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            let doctor = null;
            let currentLanguage = 'en';
            let currentAppointment = null;

            const translations = {
                en: { welcome_message: "Welcome, {name}", welcome_subtitle: "Your dashboard is ready.", upcoming_appointments: "Upcoming Appointments", for_today: "For today", completed_today: "Completed Today", consultations: "Consultations", dashboard_nav: "Dashboard", upload_nav: "Upload Rx", earnings_nav: "Earnings", upload_rx_title: "Upload Offline Prescription", select_patient: "Select Patient", upload_image: "Upload Prescription Image", drag_drop: "Click to upload a photo", save_to_record: "Save to Patient Record", earnings_title: "Earnings & History", write_prescription: "Write Prescription", end_call: "End Call", prescription_writer_title: "New Digital Prescription", medicine_name: "Medicine Name", dosage: "Dosage", advice: "Advice", send_prescription: "Sign & Send Prescription", summary_symptoms: "Logged Symptoms", summary_vitals: "Recent Vitals (from ASHA)", summary_prescriptions: "Active Prescriptions", logout: "Logout", appointments_nav: "Appointments", appointments_title: "Today's Appointments", your_reply: "Your Reply", call_patient: "Call", message_patient: "Message", view_summary: "Summary", view_prescription: "View Rx", history_title: "Recent Activity", recent_activity: "Recent Activity", last_4_days: "Last 4 days"},
                hi: { welcome_message: "नमस्ते, {name}", welcome_subtitle: "आपका डैशबोर्ड तैयार है।", upcoming_appointments: "आगामी अपॉइंटमेंट्स", for_today: "आज के लिए", completed_today: "आज पूर्ण हुए", consultations: "परामर्श", dashboard_nav: "डैशबोर्ड", upload_nav: "Rx अपलोड करें", earnings_nav: "कमाई", upload_rx_title: "ऑफलाइन प्रिस्क्रिप्शन अपलोड करें", select_patient: "मरीज़ चुनें", upload_image: "प्रिस्क्रिप्शन फोटो अपलोड करें", drag_drop: "फोटो अपलोड करने के लिए क्लिक करें", save_to_record: "मरीज़ के रिकॉर्ड में सहेजें", earnings_title: "कमाई और इतिहास", write_prescription: "प्रिस्क्रिप्शन लिखें", end_call: "कॉल समाप्त करें", prescription_writer_title: "नया डिजिटल प्रिस्क्रिप्शन", medicine_name: "दवा का नाम", dosage: "खुराक", advice: "सलाह", send_prescription: "हस्ताक्षर करें और भेजें", summary_symptoms: "दर्ज लक्षण", summary_vitals: "हाल के वाइटल्स (आशा से)", summary_prescriptions: "सक्रिय प्रिस्क्रिप्शन", logout: "लॉग आउट", appointments_nav: "अपॉइंटमेंट्स", appointments_title: "आज की अपॉइंटमेंट्स", your_reply: "आपका जवाब", call_patient: "कॉल", message_patient: "मैसेज", view_summary: "विवरण", view_prescription: "Rx देखें", history_title: "हाल की गतिविधि", recent_activity: "हाल की गतिविधि", last_4_days: "पिछले 4 दिन"}
            };

            const appData = {
                appointments: [
                    { id: 1, patient: "Ramesh Kumar", time: "10:30 AM", type: "video", message: "Hello Doctor, I've been having a slight headache since yesterday morning." },
                    { id: 2, patient: "Sunita Devi", time: "11:00 AM", type: "audio", message: "Good morning Dr, just confirming my appointment for today." },
                    { id: 3, patient: "Geeta Singh", time: "02:15 PM", type: "video", message: "Hi, I wanted to ask about the rash on my arm. Is it serious?" },
                ],
                history: [
                    { id: 101, patient: "Amit Patel", date: "2025-09-28", time: "09:00 AM", status: "Done" },
                    { id: 102, patient: "Priya Sharma", date: "2025-09-28", time: "09:30 AM", status: "Done" },
                    { id: 1, patient: "Ramesh Kumar", date: "2025-09-28", time: "10:30 AM", status: "Done" },
                    { id: 103, patient: "Anil Kapoor", date: "2025-09-27", time: "02:00 PM", status: "Missed" },
                    { id: 104, patient: "Sunita Reddy", date: "2025-09-27", time: "03:00 PM", status: "Done" },
                    { id: 105, patient: "Karan Verma", date: "2025-09-26", time: "11:00 AM", status: "Rescheduled" },
                    { id: 106, patient: "Meena Kumari", date: "2025-09-25", time: "04:00 PM", status: "Done" },
                ],
                summaries: {
                    1: { patient: "Ramesh Kumar", symptoms: ["Fever, cough for 3 days"], vitals: ["BP: 120/80 mmHg"], prescriptions: ["None active"] },
                    2: { patient: "Sunita Devi", symptoms: ["Headache, fatigue"], vitals: ["SPO2: 98%"], prescriptions: ["Paracetamol 500mg"] },
                    3: { patient: "Geeta Singh", symptoms: ["Skin rash on arm"], vitals: ["N/A"], prescriptions: ["None active"] }
                },
                prescriptions: {
                    1: { patient: "Ramesh Kumar", medicine: "Paracetamol 500mg", dosage: "1-0-1 After Food", advice: "Take for 3 days if fever persists." },
                    2: { patient: "Sunita Devi", medicine: "Cetirizine 10mg", dosage: "0-0-1 After Food", advice: "Take for 5 days for allergy symptoms." },
                    3: { patient: "Geeta Singh", medicine: "Betamethasone Cream", dosage: "Apply twice daily", advice: "Apply a thin layer on the affected area." }
                },
                earnings: [
                    { date: "2025-09-27", patient: "Amit Patel", fee: 150, status: "Paid" },
                    { date: "2025-09-27", patient: "Priya Sharma", fee: 150, status: "Paid" },
                    { date: "2025-09-28", patient: "Ramesh Kumar", fee: 150, status: "Pending" }
                ]
            };
            
            function checkAuth() {
                doctor = { fullName: "Dr. Anjali Verma" };
                return true;
            }

            function updateUIText() {
                const langPack = translations[currentLanguage] || translations.en;
                document.querySelectorAll('[data-key]').forEach(el => {
                    const key = el.getAttribute('data-key');
                    let text = langPack[key];
                    if (key === 'welcome_message' && doctor) {
                        text = text.replace('{name}', doctor.fullName);
                    }
                    if (text) el.textContent = text;
                });
            }

            function showScreen(screenId) {
                document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
                document.getElementById(screenId)?.classList.add('active');
                
                document.querySelectorAll('.nav-button, .top-nav a').forEach(link => {
                    link.classList.toggle('active', link.dataset.screen === screenId);
                });
            }
            
            function setupNavigation() {
                document.querySelectorAll('[data-screen]').forEach(el => {
                    el.addEventListener('click', (e) => {
                        // If the element is a card AND the click target is a button inside it, ignore the card's navigation.
                        if (el.classList.contains('card') && e.target.closest('button')) {
                            return;
                        }
                        // Allow navigation for all other cases (e.g., clicking the card itself, or clicking a button that has a data-screen attribute).
                        e.preventDefault();
                        showScreen(el.dataset.screen);
                    });
                });
            }

            function setupThemeAndLanguage() {
                const themeToggle = document.getElementById('themeToggle');
                const themeIcon = document.getElementById('themeIcon');
                const sunIcon = `<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"></circle><line x1="12" y1="1" x2="12" y2="3"></line><line x1="12" y1="21" x2="12" y2="23"></line><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line><line x1="1" y1="12" x2="3" y2="12"></line><line x1="21" y1="12" x2="23" y2="12"></line><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line></svg>`;
                const moonIcon = `<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path></svg>`;

                themeToggle.addEventListener('click', () => {
                    const currentTheme = document.body.getAttribute('data-theme');
                    const newTheme = currentTheme === 'dark' ? 'light' : 'dark';
                    document.body.setAttribute('data-theme', newTheme);
                    themeIcon.innerHTML = newTheme === 'dark' ? sunIcon : moonIcon;
                });
                
                const langDropdown = document.querySelector('.language-dropdown');
                const langMenu = langDropdown.querySelector('.language-dropdown-menu');
                Object.keys(translations).forEach(lang => {
                    const option = document.createElement('a');
                    option.href = "#"; option.className = 'language-option'; option.dataset.lang = lang;
                    option.textContent = new Intl.DisplayNames([lang], { type: 'language' }).of(lang);
                    langMenu.appendChild(option);
                });

                langDropdown.querySelector('.language-dropdown-toggle').addEventListener('click', () => langDropdown.classList.toggle('open'));
                document.addEventListener('click', e => { if (!langDropdown.contains(e.target)) langDropdown.classList.remove('open'); });
                langMenu.addEventListener('click', e => {
                    if (e.target.classList.contains('language-option')) {
                        currentLanguage = e.target.dataset.lang;
                        document.getElementById('selectedLanguage').textContent = e.target.textContent;
                        updateUIText();
                        langDropdown.classList.remove('open');
                    }
                });
            }

            function generateAppointments() {
                const container = document.getElementById('appointmentsList');
                container.innerHTML = appData.appointments.map(appt => `
                    <div class="card appointment-card">
                        <div style="display: flex; align-items: center;">
                           <div class="appointment-type-indicator type-${appt.type}"></div>
                           <div class="appointment-card-details">
                                <h4>${appt.patient}</h4>
                                <p>${appt.time} &middot; ${appt.type.charAt(0).toUpperCase() + appt.type.slice(1)} Call</p>
                           </div>
                        </div>
                        <div class="appointment-actions">
                             <button class="btn btn-sm btn-call" data-patient="${appt.patient}" data-key="call_patient">Call</button>
                             <button class="btn btn-sm btn-message" data-id="${appt.id}" data-key="message_patient">Message</button>
                             <button class="btn btn-sm btn-neutral view-rx-btn" data-id="${appt.id}" data-key="view_prescription">View Rx</button>
                             <button class="btn btn-sm btn-primary view-summary-btn" data-id="${appt.id}" data-key="view_summary">Summary</button>
                        </div>
                    </div>`).join('');

                document.querySelectorAll('.view-summary-btn').forEach(btn => {
                    btn.addEventListener('click', () => showPatientSummary(btn.dataset.id));
                });
                 document.querySelectorAll('.view-rx-btn').forEach(btn => {
                    btn.addEventListener('click', () => showPrescriptionModal(btn.dataset.id));
                });
                document.querySelectorAll('.btn-call').forEach(btn => {
                    btn.addEventListener('click', () => {
                         currentAppointment = { patient: btn.dataset.patient }; // Simplified for this action
                         startCall();
                    });
                });
                 document.querySelectorAll('.btn-message').forEach(btn => {
                    btn.addEventListener('click', () => showMessageModal(btn.dataset.id));
                });
                updateUIText();
            }

            function generateHistoryList() {
                const container = document.getElementById('historyList');
                container.innerHTML = appData.history.map(appt => `
                    <div class="card history-card">
                        <div>
                            <h4>${appt.patient}</h4>
                            <p>${new Date(appt.date).toLocaleDateString()} - ${appt.time}</p>
                        </div>
                        <span class="status-badge status-${appt.status.toLowerCase()}">${appt.status}</span>
                    </div>`).join('');
            }
            
            function showPatientSummary(appointmentId) {
                currentAppointment = appData.summaries[appointmentId];
                if (!currentAppointment) return;

                document.getElementById('summaryModalTitle').textContent = `AI Pre-Read: ${currentAppointment.patient}`;
                document.getElementById('summarySymptoms').innerHTML = currentAppointment.symptoms.map(s => `<li>${s}</li>`).join('');
                document.getElementById('summaryVitals').innerHTML = currentAppointment.vitals.map(v => `<li>${v}</li>`).join('');
                document.getElementById('summaryPrescriptions').innerHTML = currentAppointment.prescriptions.map(p => `<li>${p}</li>`).join('');

                document.getElementById('aiSummaryModal').classList.add('active');
            }

            function showPrescriptionModal(appointmentId) {
                const prescription = appData.prescriptions[appointmentId];
                if (!prescription) {
                    showConfirmationModal('No Prescription Found', 'There is no recent digital prescription for this patient.');
                    return;
                }

                const modal = document.getElementById('prescriptionViewModal');
                modal.querySelector('#rxPatientName').textContent = prescription.patient;
                modal.querySelector('#rxMedicine').textContent = prescription.medicine;
                modal.querySelector('#rxDosage').textContent = prescription.dosage;
                modal.querySelector('#rxAdvice').textContent = prescription.advice;
                modal.classList.add('active');
            }
            
            function showMessageModal(appointmentId) {
                const appointment = appData.appointments.find(a => a.id == appointmentId);
                if (!appointment) return;
                
                const modal = document.getElementById('messageModal');
                const chatBox = document.getElementById('chatBox');
                
                modal.querySelector('#messageModalTitle').textContent = `Message with ${appointment.patient}`;
                
                chatBox.innerHTML = `
                    <div class="chat-message patient-message">
                        <p>${appointment.message}</p>
                        <span class="message-time">10:45 AM</span>
                    </div>
                `;
                modal.querySelector('#doctor-reply').value = '';
                modal.dataset.appointmentId = appointmentId;
                modal.classList.add('active');
            }

            function startCall() {
                if (!currentAppointment) return;
                document.getElementById('aiSummaryModal').classList.remove('active');
                document.getElementById('consultationHeader').textContent = `Consultation with ${currentAppointment.patient}`;
                document.getElementById('prescriptionPatientName').textContent = currentAppointment.patient;
                showScreen('consultationScreen');
            }

            function generateEarningsHistory() {
                 const container = document.getElementById('earningsList');
                 container.innerHTML = appData.earnings.map(item => `
                    <div class="history-item">
                        <div>
                            <h4>${item.patient}</h4>
                            <p>${new Date(item.date).toLocaleDateString()}</p>
                        </div>
                        <div>
                            <h4>₹${item.fee}</h4>
                            <span class="status-badge status-${item.status.toLowerCase()}">${item.status}</span>
                        </div>
                    </div>`).join('');
            }

            function setupFormsAndModals() {
                document.getElementById('closeSummaryModal').addEventListener('click', () => document.getElementById('aiSummaryModal').classList.remove('active'));
                document.getElementById('startCallFromSummary').addEventListener('click', startCall);
                
                document.getElementById('closeMessageModal').addEventListener('click', () => document.getElementById('messageModal').classList.remove('active'));
                document.getElementById('closeRxModal').addEventListener('click', () => document.getElementById('prescriptionViewModal').classList.remove('active'));

                document.getElementById('sendMessageBtn').addEventListener('click', () => {
                    const modal = document.getElementById('messageModal');
                    const chatBox = document.getElementById('chatBox');
                    const replyTextarea = document.getElementById('doctor-reply');
                    const replyText = replyTextarea.value.trim();

                    if (replyText) {
                        const doctorMessage = document.createElement('div');
                        doctorMessage.className = 'chat-message doctor-message';
                        doctorMessage.innerHTML = `<p>${replyText}</p><span class="message-time">${new Date().toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'})}</span>`;
                        chatBox.appendChild(doctorMessage);
                        chatBox.scrollTop = chatBox.scrollHeight;
                        replyTextarea.value = '';

                        setTimeout(() => {
                           modal.classList.remove('active');
                        }, 800);
                    }
                });
                
                document.getElementById('closeModal').addEventListener('click', () => document.getElementById('confirmationModal').classList.remove('active'));

                document.getElementById('uploadRxForm').addEventListener('submit', (e) => {
                    e.preventDefault();
                    showConfirmationModal('Upload Successful', 'The prescription has been saved to the patient\'s record.');
                    showScreen('dashboardScreen');
                });
                 document.getElementById('prescriptionForm').addEventListener('submit', (e) => {
                    e.preventDefault();
                    showConfirmationModal('Prescription Sent', 'The digital prescription has been sent to the patient and their pharmacy.');
                    showScreen('dashboardScreen');
                });
            }

            function showConfirmationModal(title, message) {
                document.getElementById('modalTitle').textContent = title;
                document.getElementById('modalMessage').textContent = message;
                document.getElementById('confirmationModal').classList.add('active');
            }

            function initializeApp() {
                if(checkAuth()){
                    setupNavigation();
                    setupThemeAndLanguage();
                    generateAppointments();
                    generateHistoryList();
                    generateEarningsHistory();
                    setupFormsAndModals();
                    
                    document.getElementById('logoutBtn').addEventListener('click', () => {
                        showConfirmationModal("Logged Out", "You have been successfully logged out.");
                    });
    
                    updateUIText();
                }
            }

            initializeApp();
        });
    </script>
</body>
</html>

